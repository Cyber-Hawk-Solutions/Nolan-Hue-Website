<!-- Go To Top
	============================================= -->
<div id="gotoTop" class="icon-angle-up bgcolor"></div>

<!-- External JavaScripts
			============================================= -->
<script src="{{'assets/plugins/locomotive-scroll.min.js'  | relative_url }}"></script>
<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>



<script src="https://cdnjs.cloudflare.com/ajax/libs/wow/1.1.2/wow.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/noframework.waypoints.min.js"
	integrity="sha256-XJuslujM3cGzRZGiSi/KNSdk58uORO/mmrEQNjVtb5k=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.115.0/build/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.3.4/gsap.min.js"></script>
<script src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/16327/ScrollTrigger.min.js?v=3.4.0.1"></script>
<script src="https://cdn.jsdelivr.net/npm/hover-effect@1.1.0/dist/hover-effect.umd.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.7/plugins/debug.addIndicators.min.js"></script> -->

<script src="https://unpkg.com/@barba/core"></script>

<!-- <script>
			/* FADES IT OUT WHEN PAGE LOADS */
				$('#global-spinner').addClass('fadeOut'); //UNCOMMENT ME
		</script> -->


<!-- ADD-ONS JS FILES -->
<script>
	var locoScroll;
	window.scrollTo(0, 0);

	var timelineEls;
	var timeline;

	$(function () {
	




		gsap.registerPlugin(ScrollTrigger);

		window.onbeforeunload = function () {

			ScrollTrigger.kill()
			locoScroll.destroy()
			$(document).scrollTop(0);
		}


		// create  as many timelines as you need
		// in the html, you'll add your trigger element like this: <div data-scroll-timeline="fast-spin"></div>


		function initScroll(container) {


			$(document).scrollTop(0);
			console.log("Scroll", locoScroll, container, container.querySelector('[data-scroll-container]'))
			var condi = (container.addEventListener)? container: container[0];

			locoScroll = new LocomotiveScroll({

				el: condi.querySelector('[data-scroll-container]'),
				smooth: true,
				getSpeed: true,
				getDirection: true,
				useKeyboard: true
			});
			console.log("Test lolo", locoScroll)

			// each time Locomotive Scroll updates, tell ScrollTrigger to update too (sync positioning)
			locoScroll.on("scroll", ScrollTrigger.update);

			// tell ScrollTrigger to use these proxy methods for the ".smooth-scroll" element since Locomotive Scroll is hijacking things
			ScrollTrigger.scrollerProxy("#wrapper", {
				scrollTop(value) {
					return arguments.length ? locoScroll.scrollTo(value, 0, 0) : locoScroll.scroll.instance.scroll.y;
				}, // we don't have to define a scrollLeft because we're only scrolling vertically.
				getBoundingClientRect() {
					return { top: 0, left: 0, width: window.innerWidth, height: window.innerHeight };
				},
				// LocomotiveScroll handles things completely differently on mobile devices - it doesn't even transform the container at all! So to get the correct behavior and avoid jitters, we should pin things with position: fixed on mobile. We sense it by checking to see if there's a transform applied to the container (the LocomotiveScroll-controlled element).
				pinType: document.querySelector("#wrapper").style.transform ? "transform" : "fixed"
			});

		}

		function getProgress(elem) {
			var distance = elem.getBoundingClientRect();
			return (
				(window.innerHeight - distance.top - distance.height) /
				window.innerHeight
			);
		}


		var tl = gsap.timeline();

		


		barba.hooks.enter((data) => {
			tl = gsap.timeline();


			loadBarb(data);
			reinitTheme();

		});

		barba.hooks.after((data) => {
			// initScroll();

		});


		barba.init({

			transitions: [{
				name: 'default-transition',
				once(data){

					// init LocomotiveScroll on page load
					initScroll(data.next.container);
				},
				afterEnter(data){


					// ScrollTrigger.kill()
					// tl.to('.text-emphasis', {autoAlpha: 1, duration: 0,  onComplete: function () {
					initScroll(data.next.container);
					setTimeout(()=>{
						console.log(locoScroll.update())
					},300)
					
				},
				leave() {
					// create your stunning leave animation here
					
					$('.text-emphasis').css("opacity", 1)

					// 	}
					// })

					let barbaTl = gsap.timeline()
						.to('#reveal', { xPercent: '-100', opacity: 1, duration: 0 })
						.to('#reveal', { xPercent: '0', duration: 0.5 })
						.to(['#left-swipe', '#right-swipe'], {
							width: '0', duration: 0.5, ease: "power2.out", onComplete: function () {
								window.scrollTo(0, 0);

							}
						})
					// .to('.text-emphasis', {autoAlpha: 1, duration: 0 })
					// .to('#left-swipe', { top: '50vh', duration: 0 })
					// .to('#right-swipe', { top: '50vh', duration: 0 })

					return barbaTl;

				},
				afterLeave(){
					console.log("destroy loco")

					ScrollTrigger.kill()
					locoScroll.destroy()

					gsap.killTweensOf()
					tl.kill()
				}
			}]
		});


		loadBarb({});


		particles();

		function loadBarb(data) {
		
			// initScroll();
			// scroll.scrollTo(0)

			

			try {
				console.log("B PAGE 1", data['current']['namespace'])
			}
			catch {

			}
			console.log("B PAGE 2", window.location.pathname, Math.random())

			tl.to('#global-spinner', {
				opacity: 0, duration: 0.5, onComplete: function () {
					$("#global-spinner").hide()
				}
			})

			if (window.location.pathname == "/index" || window.location.pathname == "/") {
				console.log("PAGE HOME")

				tl.to(['#left-swipe', '#right-swipe'], { width: 0, duration: 2, ease: "power2.out" }, "<0")
				tl.to('#left-swipe', { top: '50vh', duration: 0 })
				tl.to('#right-swipe', { bottom: '50vh', duration: 0 })
				tl.to(['#left-swipe', '#right-swipe'], {
					width: '100%', duration: 1, ease: "power2.out", onComplete: function () {

					}
				})
				tl.to('#reveal', { opacity: 0, duration: 0.5 }, ">-0.5")
				tl.fromTo('#slider', { filter: "saturate(0.5) blur(4px)" }, { filter: "saturate(1) blur(0px)", duration: 0.5, ease: "power1.out" })
				tl.from('#hero-button1', { opacity: 0, duration: 0.5, ease: "power2.out" }, "<0")
				tl.from('#hero-title', { opacity: 0, y: +100, duration: 0.5, ease: "power1.out" }, "<0.3")
				tl.from('#header-wrap', { width: 0, duration: 0.5, ease: "power2.out" })

				// loadEvents()
			} else {

				console.log("PAGE INNER")
				tl.to(['#left-swipe', '#right-swipe'], { width: 0, duration: 0.5, ease: "power2.out" }, "<0")
				tl.to('#left-swipe', { top: '50vh', duration: 0 })
				tl.to('#right-swipe', { bottom: '50vh', duration: 0 })
				tl.to(['#left-swipe', '#right-swipe'], { width: '100%', duration: 0.7, ease: "power2.out" })
				tl.to('#reveal', {
					opacity: 0, duration: 0.2, onComplete: () => {
					}
				}, ">-0.1")
				// tl.from('#slider strong', { top: +300, duration: 1, stagger: 0.2 }, "<0.3")
				// tl.fromTo('#slider strong', { opacity: 0 }, {
				// 	opacity: 1, duration: 1, stagger: 0.2, onComplete: function () {
				// 		// $('.text-blend strong').css('opacity', '0')
				// 	}
				// }, "<0")
			}


			tl.from('#primary-menu>ul>li', { opacity: 0, x: +170, stagger: 0.2, duration: 0.5, ease: "power1.out" })
			tl.from('#logo', { opacity: 0, duration: 0.5, ease: "power2.out", }, "<0.2")
			tl.from('#hero-button2', { opacity: 0, duration: 0.5, delay: 1, ease: "power2.out" }, "<-0.5")
			tl.to('#left-swipe', { top: '0', duration: 0 })
			tl.to('#right-swipe', { bottom: '0', duration: 0 })

			console.log("load page effects")
			pageEffects();

			// {% for event in site.events %}
			// var myAnimation = new hoverEffect({
			// 	parent: document.querySelector('.{{event.shortName}}-distort'),
			// 	intensity: 0.1,
			// 	image1: '{{ event.banner | relative_url}}',
			// 	image2: '{{ event.banner2 | relative_url}}',
			// 	angle: Math.PI / 2,
			// 	displacementImage: '{{ 'assets/images/transition.jpg' | relative_url}}',
			// 	imagesRatio: 1200 / 1800
			// 	});
			// {% endfor %}
		}; /* END OF ON LOAD FUNCTION */

		function particles() {

			$("#particles-js").appendTo("#SLIDE1");

			setTimeout(() => {
				// $('.rellax').removeClass('animated');
				// $('.remove-animation').removeClass('animated');
				// var rellax = new Rellax('.rellax');

			}, 2000)


			particlesJS.load('particles-js', "{{'assets/js/particlesjs-simple-config.json' | relative_url}}", function () {
				console.log('callback - particles.js config loaded');
				// console.log("load scroll")

				setTimeout(() => {
					let particleAction = gsap.timeline()
						.to('.particles-js-canvas-el', { autoAlpha: 0.2, duration: window.innerHeight, })

				}, 300)
			});

			// $('#google-map').gMap({
			// 	address: 'Melbourne, Australia',
			// 	maptype: 'ROADMAP',
			// 	zoom: 14,
			// 	markers: [
			// 		{
			// 			address: "Melbourne, Australia",
			// 			html: '<div style="width: 300px;"><h4 style="margin-bottom: 8px;">Hi, we\'re <span>Envato</span></h4><p class="nobottommargin">Our mission is to help people to <strong>earn</strong> and to <strong>learn</strong> online. We operate <strong>marketplaces</strong> where hundreds of thousands of people buy and sell digital goods every day, and a network of educational blogs where millions learn <strong>creative skills</strong>.</p></div>',
			// 			icon: {
			// 				image: "assets/images/icons/map-icon-red.png",
			// 				iconsize: [32, 39],
			// 				iconanchor: [32, 39]
			// 			}
			// 		}
			// 	],
			// 	doubleclickzoom: false,
			// 	controls: {
			// 		panControl: true,
			// 		zoomControl: true,
			// 		mapTypeControl: true,
			// 		scaleControl: false,
			// 		streetViewControl: false,
			// 		overviewMapControl: false
			// 	}

			// });
		}

		function pageEffects() {

			gsap.to(".text-emphasis strong", {
				scrollTrigger: {
					trigger: ".text-blend strong",
					scroller: "#wrapper",
					scrub: true,
					start: "bottom 50%",
					end: "top top"
				},
				opacity: 0.3,
				ease: "none"
			});

			$(".scroll-title strong").each(function(){
				gsap.to(this, {
					scrollTrigger: {
						trigger: this,
						scroller: "#wrapper",
						scrub: true,
						start: "top bottom",
						end: "bottom top"
					},
					x: "1600px",
					ease: "none"
				});				
			})

			gsap.to('.parallax-effect-0', {
				scrollTrigger: {
					trigger: '.parallax-effect-0',
					scroller: "#wrapper",
					toggleActions: "play none none reverse",
					start: "top center",
					end: "bottom top"
				},
				duration: 1,
				scaleX: 0, transformOrigin: "center left",
			});			

			gsap.to('.parallax-effect-1', {
				scrollTrigger: {
					trigger: '.parallax-effect-1',
					scroller: "#wrapper",
					toggleActions: "play none none reverse",
					start: "top center",
					end: "bottom top"
				},
				duration: 1,
				scaleX: 0, transformOrigin: "center right",
			});			

			gsap.to('.parallax-effect-2', {
				scrollTrigger: {
					trigger: '.parallax-effect-2',
					scroller: "#wrapper",
					toggleActions: "play none none reverse",
					start: "top center",
					end: "bottom top"
				},
				duration: 1,
				scaleX: 0, duration: 1, transformOrigin: "center left",
			});			

			// let eventReveal1 = gsap.timeline()
      //         .to( { scaleX: 0, duration: 1, transformOrigin: "center left" })
  
  
          //   new ScrollMagic.Scene({
          //     triggerElement: '.parallax-effect-0',
          //     triggerHook: 0,
          //     offset: -300,
          //     reverse: true
          //   })
          //     .setTween(eventReveal1)
          //     // .addIndicators()
          //     .addTo(controller)
  
          //   let eventReveal2 = gsap.timeline()
          //     .to('.parallax-effect-1', {  })
  
  
          //   new ScrollMagic.Scene({
          //     triggerElement: '.parallax-effect-1',
          //     triggerHook: 0,
          //     offset: -300,
          //     reverse: true
          //   })
          //     .setTween(eventReveal2)
          //     // .addIndicators()
          //     .addTo(controller)
  
          //   let eventReveal3 = gsap.timeline()
          //     .to('.parallax-effect-2', { scaleX: 0, duration: 1, transformOrigin: "center left" })
  
  
          //   new ScrollMagic.Scene({
          //     triggerElement: '.parallax-effect-2',
          //     triggerHook: 0,
          //     offset: -300,
          //     reverse: true
          //   })
          //     .setTween(eventReveal3)
          //     // .addIndicators()
          //     .addTo(controller)
          //   // });
          // }, 1000);






			if (!jQuery('body').hasClass('device-touch')) {

				var lFollowX = 0,
					lFollowY = 0,
					x = 0,
					y = 0,
					friction = 1 / 30;

				function moveBackground() {
					x += (lFollowX - x) * friction;
					y += (lFollowY - y) * friction;

					translate = 'translate(' + x + 'px, ' + y + 'px) scale(1.1)';

					jQuery('.move-bg').css({
						'-webit-transform': translate,
						'-moz-transform': translate,
						'transform': translate
					});

					window.requestAnimationFrame(moveBackground);
				}

				jQuery(window).on('mousemove click', function (e) {

					var lMouseX = Math.max(-100, Math.min(100, jQuery(window).width() / 2 - e.clientX));
					var lMouseY = Math.max(-100, Math.min(100, jQuery(window).height() / 2 - e.clientY));
					lFollowX = (10 * lMouseX) / 100; // 100 : 12 = lMouxeX : lFollow
					lFollowY = (10 * lMouseY) / 100;

				});
			}

			moveBackground();

			jQuery(".book-wrap").hover3d({
				selector: ".book-card",
				shine: false,
			});

			var titles = [];


			setTimeout(() => {

				let last_known_scroll_position = 0;
				let ticking = false;



				window.addEventListener('scroll', function (e) {
					last_known_scroll_position = window.scrollY;


					if (!ticking) {
						// window.requestAnimationFrame(function () {
						// 	if (last_known_scroll_position == 0)
						// 		$('.text-blend strong').css('opacity', '0')
						// 	else
						// 		$('.text-blend strong').css('opacity', '1')
						// 	ticking = false;
						// });

						ticking = true;
					}
				});



				// the animation to use
				// const tl = gsap.timeline();
				// tl.from("h1", {scale: 5});

				// // The start and end positions in terms of the page scroll
				// const startY = innerHeight / 10;
				// const finishDistance = innerHeight / 5;

				// Listen to the scroll event
				// document.addEventListener("scroll", function() {
				// 	// Prevent the update from happening too often (throttle the scroll event)
				// 	if (!requestId) {
				// 		requestId = requestAnimationFrame(update);
				// 	}
				// });

				// update();

				// function update() {
				// 	// Update our animation
				// 	tl.progress((scrollY - startY) / finishDistance);

				// 	// Let the scroll event fire again
				// 	requestId = null;
				// }



			}, 500)
		}

		function reinitTheme() {
			$('script').each(function () {
				if (this.src === '/assets/js/functions.js') {

					this.parentNode.removeChild(this);
				}
			});

			let script = document.createElement('script');
			script.src = '/assets/js/functions.js';
			document.body.appendChild(script);

			particles();

		}

	}()); /* END OF WRAPPING FUNCTION */

	Object.prototype.hasOwnProperty = function (property) {
		return this[property] !== undefined;
	};
</script><!-- Google Map End -->

<!-- <script>
	
		// Hover Script
		jQuery(".img-hover-wrap").hover3d({
			selector: ".img-hover-card",
			shine: false,
		});
	
	</script> -->