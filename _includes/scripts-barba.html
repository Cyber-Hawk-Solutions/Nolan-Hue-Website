<!-- Go To Top
	============================================= -->
<div id="gotoTop" class="icon-angle-up bgcolor"></div>


<!-- External JavaScripts
			============================================= -->
<script src="{{'assets/js/rellax.min.js'  | relative_url }}"></script>
<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
<script src="{{'assets/js/plugins.js' | relative_url }}"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/wow/1.1.2/wow.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/noframework.waypoints.min.js"
	integrity="sha256-XJuslujM3cGzRZGiSi/KNSdk58uORO/mmrEQNjVtb5k=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.115.0/build/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.2.6/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hover-effect@1.1.0/dist/hover-effect.umd.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.7/ScrollMagic.min.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.7/plugins/debug.addIndicators.min.js"></script> -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.7/plugins/animation.gsap.min.js"></script>
<script src="https://unpkg.com/@barba/core"></script>

<!-- <script>
			/* FADES IT OUT WHEN PAGE LOADS */
				$('#global-spinner').addClass('fadeOut'); //UNCOMMENT ME
		</script> -->


<!-- ADD-ONS JS FILES -->
<script>
	$(function () {
		// enter() {

		// 	let barbaTl2 = gsap.timeline()
		// 	.to(['#left-swipe', '#right-swipe'], { width: '100%', duration: 1, ease: "power2.out" })
		// 	.to('#reveal', { opacity: 0, duration: 0.5 }, ">-0.5")

		// 	return barbaTl2;
		// }

		console.log("GONNA TRY")

		barba.init({

			transitions: [{
				name: 'default-transition',
				leave() {
					// create your stunning leave animation here

					let barbaTl = gsap.timeline()
						.to('#reveal', {xPercent: '-100', opacity:1, duration: 0})
						.to('#reveal', {xPercent: '0', duration: 0.5})
						.to(['#left-swipe', '#right-swipe'], { width: '0', duration: 0.5, ease: "power2.out" })
						// .to('#left-swipe', { top: '50vh', duration: 0 })
						// .to('#right-swipe', { top: '50vh', duration: 0 })

					return barbaTl;

				}
			}]
		});

		barba.hooks.enter((data) => {
			$(window).scrollTop(0); // scroll to top here

			console.log("ENTER")
			loadBarb(data);
			reinitTheme();
		});

		loadBarb({});
		particles();

		function loadBarb(data) {

			console.log("PAGE LOADED", data)
			let tl = gsap.timeline();

			tl.to('#global-spinner', {
				opacity: 0, duration: 0.5, onComplete: function () {
					$("#global-spinner").hide()
				}
			})

			if ( data.hasOwnProperty('current')? data['current']['namespace'] == "index":false || window.location.pathname == "/") {
				tl.to(['#left-swipe', '#right-swipe'], { width: 0, duration: 2, ease: "power2.out" }, "<0")
				tl.to('#left-swipe', { top: '50vh', duration: 0 })
				tl.to('#right-swipe', { bottom: '50vh', duration: 0 })
				tl.to(['#left-swipe', '#right-swipe'], { width: '100%', duration: 1, ease: "power2.out" })
				tl.to('#reveal', { opacity: 0, duration: 0.5 }, ">-0.5")
				tl.fromTo('#slider', { filter: "saturate(0.5) blur(4px)" }, { filter: "saturate(1) blur(0px)", duration: 0.5, ease: "power1.out" })
				tl.from('#hero-button1', { opacity: 0, duration: 0.5, ease: "power2.out" }, "<0")
				tl.from('#hero-title', { opacity: 0, y: +100, duration: 0.5, ease: "power1.out" }, "<0.3")
				tl.from('#header-wrap', { width: 0, duration: 0.5, ease: "power2.out" })
			} else  {

				tl.to(['#left-swipe', '#right-swipe'], { width: 0, duration: 0.5, ease: "power2.out" }, "<0")
				tl.to('#left-swipe', { top: '50vh', duration: 0 })
				tl.to('#right-swipe', { bottom: '50vh', duration: 0 })
				tl.to(['#left-swipe', '#right-swipe'], { width: '100%', duration: 0.7, ease: "power2.out" })
				tl.to('#reveal', { opacity: 0, duration: 0.2 }, ">-0.1")
				tl.from('#slider strong', { top: +300, duration: 1, stagger: 0.2 }, "<0.3")
				tl.from('#slider strong', {
					opacity: 0, duration: 1, stagger: 0.2, onComplete: function () {
						$('.text-blend strong').css('opacity', '0')
					}
				}, "<0")


			}
			

			tl.from('#primary-menu>ul>li', { opacity: 0, x: +170, stagger: 0.2, duration: 0.5, ease: "power1.out" }, "=-1")
			tl.from('#logo', { opacity: 0, duration: 0.5, ease: "power2.out", }, "<0.2")
			tl.from('#hero-button2', { opacity: 0, duration: 0.5, delay: 1, ease: "power2.out" }, "<-0.5")
			tl.to('#left-swipe', { top: '0', duration: 0 })
			tl.to('#right-swipe', { bottom: '0', duration: 0 })
			
			console.log("load page effects")
			pageEffects();

			// {% for event in site.events %}
			// var myAnimation = new hoverEffect({
			// 	parent: document.querySelector('.{{event.shortName}}-distort'),
			// 	intensity: 0.1,
			// 	image1: '{{ event.banner | relative_url}}',
			// 	image2: '{{ event.banner2 | relative_url}}',
			// 	angle: Math.PI / 2,
			// 	displacementImage: '{{ 'assets/images/transition.jpg' | relative_url}}',
			// 	imagesRatio: 1200 / 1800
			// 	});
			// {% endfor %}
		}; /* END OF ON LOAD FUNCTION */

		function particles() {


			$("#particles-js").appendTo("#SLIDE1");

			setTimeout(() => {
				// $('.rellax').removeClass('animated');
				// $('.remove-animation').removeClass('animated');
				var rellax = new Rellax('.rellax');
			}, 2000)


			particlesJS.load('particles-js', "{{'assets/js/particlesjs-simple-config.json' | relative_url}}", function () {
				console.log('callback - particles.js config loaded');
			});

			particlesJS.load('particles-js-green', "{{'assets/js/particlesjs-config-green.json' | relative_url }}", function () {
				console.log('callback - particles.js config loaded');
			});

			$('#google-map').gMap({
				address: 'Melbourne, Australia',
				maptype: 'ROADMAP',
				zoom: 14,
				markers: [
					{
						address: "Melbourne, Australia",
						html: '<div style="width: 300px;"><h4 style="margin-bottom: 8px;">Hi, we\'re <span>Envato</span></h4><p class="nobottommargin">Our mission is to help people to <strong>earn</strong> and to <strong>learn</strong> online. We operate <strong>marketplaces</strong> where hundreds of thousands of people buy and sell digital goods every day, and a network of educational blogs where millions learn <strong>creative skills</strong>.</p></div>',
						icon: {
							image: "assets/images/icons/map-icon-red.png",
							iconsize: [32, 39],
							iconanchor: [32, 39]
						}
					}
				],
				doubleclickzoom: false,
				controls: {
					panControl: true,
					zoomControl: true,
					mapTypeControl: true,
					scaleControl: false,
					streetViewControl: false,
					overviewMapControl: false
				}

			});
		}

		function pageEffects() {

			if (!jQuery('body').hasClass('device-touch')) {

				var lFollowX = 0,
					lFollowY = 0,
					x = 0,
					y = 0,
					friction = 1 / 30;

				function moveBackground() {
					x += (lFollowX - x) * friction;
					y += (lFollowY - y) * friction;

					translate = 'translate(' + x + 'px, ' + y + 'px) scale(1.1)';

					jQuery('.move-bg').css({
						'-webit-transform': translate,
						'-moz-transform': translate,
						'transform': translate
					});

					window.requestAnimationFrame(moveBackground);
				}

				jQuery(window).on('mousemove click', function (e) {

					var lMouseX = Math.max(-100, Math.min(100, jQuery(window).width() / 2 - e.clientX));
					var lMouseY = Math.max(-100, Math.min(100, jQuery(window).height() / 2 - e.clientY));
					lFollowX = (10 * lMouseX) / 100; // 100 : 12 = lMouxeX : lFollow
					lFollowY = (10 * lMouseY) / 100;

				});

				moveBackground();

				jQuery(".book-wrap").hover3d({
					selector: ".book-card",
					shine: false,
				});


				var controller = new ScrollMagic.Controller();

				// build scenes using a loop
				$(".scroll-title").each(function (i) {
					let thisLine = $(this);

					let action = gsap.timeline()
						.fromTo(thisLine, { x: '-25%' }, { x: '26%', duration: window.innerWidth / 4, })

					new ScrollMagic.Scene({
						triggerElement: this,
						duration: 8000,
						triggerHook: 1
					})
						.setTween(action)
						// .addIndicators()
						.addTo(controller)
				});

				let titleAction = gsap.timeline()
					.to('.text-emphasis', { autoAlpha: 0, duration: 1, })

				new ScrollMagic.Scene({
					triggerElement: '.text-emphasis',
					duration: 1000,
					triggerHook: 0.25
				})
				.setTween(titleAction)
				// .addIndicators()
				.addTo(controller)

				setTimeout(()=>{
					let particleAction = gsap.timeline()
						.to('.particles-js-canvas-el', { autoAlpha: 0.3, duration: window.innerHeight, })

					new ScrollMagic.Scene({
						triggerElement: 'body',
						duration: 1000,
						triggerHook: 0
					})
					.setTween(particleAction)
					// .addIndicators()
					.addTo(controller)
				}, 800)

			}


			setTimeout(() => {

				let last_known_scroll_position = 0;
				let ticking = false;



				window.addEventListener('scroll', function (e) {
					last_known_scroll_position = window.scrollY;


					if (!ticking) {
						window.requestAnimationFrame(function () {
							if (last_known_scroll_position == 0)
								$('.text-blend strong').css('opacity', '0')
							else
								$('.text-blend strong').css('opacity', '1')
							ticking = false;
						});

						ticking = true;
					}
				});



				// the animation to use
				// const tl = gsap.timeline();
				// tl.from("h1", {scale: 5});

				// // The start and end positions in terms of the page scroll
				// const startY = innerHeight / 10;
				// const finishDistance = innerHeight / 5;

				// Listen to the scroll event
				// document.addEventListener("scroll", function() {
				// 	// Prevent the update from happening too often (throttle the scroll event)
				// 	if (!requestId) {
				// 		requestId = requestAnimationFrame(update);
				// 	}
				// });

				// update();

				// function update() {
				// 	// Update our animation
				// 	tl.progress((scrollY - startY) / finishDistance);

				// 	// Let the scroll event fire again
				// 	requestId = null;
				// }


				var waypoint = new Waypoint({
					element: document.getElementById('rev_slider_120_1'),
					handler: setTimeout(function (direction) {

						if (tpj === undefined) {
							tpj = jQuery;

							if ("off" == "on") tpj.noConflict();
						}
						if (tpj("#rev_slider_120_1").revolution == undefined) {
							revslider_showDoubleJqueryError("#rev_slider_120_1");
						} else {
							revapi120 = tpj("#rev_slider_120_1").show().revolution({
								sliderType: "hero",
								jsFileLocation: "include/rs-plugin/js/",
								sliderLayout: "fullwidth",
								dottedOverlay: "none",
								delay: 9000,
								navigation: {
								},
								viewPort: {
									enable: true,
									outof: "wait",
									visible_area: "80%",
									presize: true
								},
								responsiveLevels: [1240, 1024, 778, 778],
								visibilityLevels: [1240, 1024, 778, 778],
								gridwidth: [1240, 1024, 778, 778],
								gridheight: [900, 900, 800, 800],
								lazyType: "none",
								parallax: {
									type: "scroll",
									origo: "slidercenter",
									speed: 400,
									speedbg: 0,
									speedls: 1000,
									levels: [3, 6, 9, 12, 15, 18, 21, -3, -6, -9, -12, -15, -18, -21, -16, 55],
								},
								shadow: 0,
								spinner: "off",
								autoHeight: "off",
								disableProgressBar: "on",
								hideThumbsOnMobile: "off",
								hideSliderAtLimit: 0,
								hideCaptionAtLimit: 0,
								hideAllCaptionAtLilmit: 0,
								debugMode: false,
								fallbacks: {
									simplifyAll: "off",
									disableFocusListener: false,
								}
							});
						}; /* END OF revapi call */

						RsTypewriterAddOn(tpj, revapi120);
					}, 1000)
				}, { offset: '70%' })
			}, 2500)
			new WOW().init();
		}

		function reinitTheme(){
			$('script').each(function() {
				if (this.src === '/assets/js/functions.js') {

					this.parentNode.removeChild( this );
				}
			});

			let script = document.createElement('script');
			script.src = '/assets/js/functions.js';
			document.body.appendChild(script);
			particles();
		}

	}()); /* END OF WRAPPING FUNCTION */

	Object.prototype.hasOwnProperty = function(property) {
    return this[property] !== undefined;
	};
</script><!-- Google Map End -->

<!-- <script>
	
		// Hover Script
		jQuery(".img-hover-wrap").hover3d({
			selector: ".img-hover-card",
			shine: false,
		});
	
	</script> -->

